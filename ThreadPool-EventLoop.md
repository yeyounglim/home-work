# <스레드 풀과 이벤트 루프>

Pool : 준비 상태로 초기화 된 개체의 집합
## 스레드 풀(Thread Pool)
- 스레드를 효율적으로 관리하고 재사용 하기 위한 매커니즘

### 요약
- 하드웨어의 성능에는 한계가 있기 때문에 스레드를 무한으로 만들 수 없다.
- 스레드의 수를 제한하는 스레드 풀을 운용하여 프로그램 성능 저하를 방지하고 다수의 요청을 처리할 수 있다.

## Thread per request model
:(Servlet 기반의 전통적인 Spring MVC가 사용)  
:(spring mvc는 thread pool 기반 / spring-webflux/node.js는 event loop기반)

- 하나의 요청 하나의 스레드(병렬 작업 형태)
- 요청마다 스레드를 생성하면 CPU 오버헤드 발생(컨텍스트 스위칭)
- 미리 스레드를 만들어 놓고 재사용 하기 때문에 스레드의 생성/삭제 비용 절약(소멸 시키지 않고 대기)
- 스레드 개수를 제한하여 스레드가 무한 생성 되는 것을 방지
- 큐의 사이즈를 제한하지 않으면 태스크가 무한대로 쌓이기 때문에 메모리 고갈 위험(큐가 꽉차면 이후 작업은 버려야 함)

## ExecutorService
- java.util.concurrent Executors 클래스
- ExecutorService 인터페이스로 스레드 풀 구현 가능
- 태스크(Runnable, Callable)를 스레드 풀에 넣으면 결과를 수집하는 인터페이스를 제공
- 개발자 대신 구동 환경에 맞춰 스레드를 컨트롤 해준다

## 동작 방식
1. 미리 정한 스레드 개수로 스레드풀 생성
2. 작업 요청이 오면 사용 가능한 스레드를 할당
3. 대기중인 스레드가 없으면 큐에 요청을 쌓거나 거부
4. 작업 완료 후 다시 스레드 풀로 돌아가 대기

## 장점
1. I/O작업을 비동기로 처리할 때 유리
2. CPU를 많이 사용하는 작업 시 유리
3. 리소스 관리  : 생성 소멸 오버 헤드를 줄여줌
4. 로드 밸런싱: 사용 가능한 스레드 간의 작업을 분산. 개별 스레드의 과부화 방지
5. 오류 처리 단순화 : 스레드가 오류나면 ExecutorService가 관리

## 단점
1. 경합 : 작업 스레드의 개수 부족으로 리소스 경합이 일어남. 성능⬇️
2. 최적 스레드 풀 설정이 어려움. 여러 요인 고려
3. 스레드 풀에 스레드를 너무 많이 생성해 두면 메모리 낭비(Fork/Join Pool로 단점 해결 가능)

## 사용 이유
- 성능 저하 방지 
- 다수의 요청 처리 가능



## 이벤트 루프(Event Loop)
- 이벤트 핸들링, 비동기 동작을 관리하는 매커니즘
- 이벤트 기반(Event Driven) 프로그래밍 방식에서 사용

### 요약
- 이벤트 핸들링, 비동기 동작을 관리
- JS는 싱글 스레드 이지만 동시성을 확보하기 위해 이벤트 루프를 사용한다.

## 자바스크립트
- single threded programming language : **한번에 하나의 작업**만 가능
- 싱글 스레드의 단점을 보완(동시성 확보)하기 위해 **비동기 콜백**(Asynchronous Callbacks) 사용
- 비동기로 동작하는 핵심 요소는 브라우저가 처리 (Web APIs) - 브라우저는 멀티 스레드
	- Ajax요청 코드
	- 이벤트 리스너
	- setTimeout 
- 이벤트 루프 기반의 비동기 방식으로 Non-blocking I/O를 지원하여 싱글 스레드의 동시성을 확보


## JS 엔진 
:JS 구문 분석 및 실행

- 메모리 힙(Memory Heap) : 데이터가 저장되는 공간(객체들)
- 콜 스택(Call Stack) : 실행 컨텍스트(Execution Context)를 저장하는 스택(함수 같은 것들. 어쨌든 JS실행 할 때 생김)

## 동작 방식
:무한 루프 돌면서 콜 스택과 콜백 큐 확인

1. 콜 스택이 비어 있는지 확인
2. 비어있으면 콜백 큐를 확인
3. 큐에 들어있는 함수들을 순차적(FIFO)으로 콜 스택으로 보낸다 

## 장점
1. 자원 절약 : 적은 자원으로도 비동기 작업을 효과적으로 할 수 있음(높은 성능)
2. 이벤트 처리에 최적화 : 웹앱에서 상호작용 빠름

## 단점
1. 한 번에 하나의 작업 : 동기 작업 시 블락되어 응답속도가 저하 될 수 있음
2. 오류 처리가 어려움 : 예외 발생 시 스택 트레이스가 날라감

## 이벤트 루프를 사용하는 이유
- **싱글 스레드인 JS를 비동기로 처리하기 위해** 사용 (사용자와 상호 작용)
