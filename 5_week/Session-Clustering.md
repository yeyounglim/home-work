# <Session 공유 방법>
이용자 수가 많은 웹 서비스는 모든 트래픽을 서버 1대로 감당할 수 없기 때문에 여러대의 서버를 사용한다. 이때 클라이언트의 요청을 골고루 분산시키기 위해 로드 밸런싱을 하게 된다.
## 로드 밸런싱(Load Balancing)
- 클라이언트로부터 오는 요청을 여러 서버로 분산 시켜주는 것
- 대용량의 트래픽을 여러 서버에 분산시켜 요청을 장애 없이 처리 하기 위해서 사용한다.

네트워크 계층에서 동작하는 L4 (전송 계층) 및 응용 계층에서 동작하는 L7 (애플리케이션 계층)의 두 가지 주요 형태로 구분

1. **L4 로드 밸런서**: TCP/IP 레벨에서 동작.  IP 주소와 포트 번호를 기반으로 트래픽을 분산. 
2. **L7 로드 밸런서**: 애플리케이션 계층에서 동작하며, HTTP 헤더, 쿠키, URL 등과 같은 애플리케이션 레이어의 데이터를 기반으로 트래픽을 분산하여 더 세밀한 로드 밸런싱과 기능을 수행할 수 있다. 대표적인 L7 로드 밸런서로는 Nginx, HAProxy, AWS의 Application Load Balancer(ALB) 등이 있다.

이런 로드 밸런싱을 하게 되면 세션 유지에 문제가 생긴다.  
유저가 로그인을 해서 1번 서버에 세션이 저장된 후
로그인 권한이 필요한 다른 요청을 했을 때 로드 밸런싱 되어 2번 서버로 요청이 갈 경우 세션 정보가 없기 때문에 다시 로그인 페이지로 리다이렉트 된다.

이를 해결하기 위해 한 번 요청에 응답을 준 서버랑만 통신하는 Sticky Session 방식(IP Tracking, cookie 사용)이 있지만 특정 서버 과부화, 서버 하나가 다운 시 그 서버의 세션이 날라가는 단점이 있다.

## 세션 클러스터링(Session Clustering)
- 여러 WAS의 세션을 하나로 묶어서 관리하는 방법
- 하나의 서버가 죽어도 다른 서버가 살아 있으면 세션이 이동된다.
- 세션을 복제 하는 방법은 TCP나 UDP 사용. 단점으로 네트워크 트래픽이 증가.
- 요청이 많아지면 동기화로 인한 부담이 커진다. 
![](https://i.imgur.com/lJoTCr9.png)


## 세션 스토리지 분리(Session Storage)
- 세션을 위한 저장소를 따로 만드는 방법
- 세션 복제가 필요없음
- 가용성을 확보하기 위해 세션 저장소 자체를 복제하는 방법도 있다.
- In-Memory 저장소를 사용한다.(Redis, Memcached)


![](https://i.imgur.com/Isp5dSK.png)





https://hyuntaeknote.tistory.com/6
