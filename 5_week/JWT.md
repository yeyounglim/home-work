## 🍪 Session-Cookie 인증
![](https://i.imgur.com/IU5TBMQ.png)

**확장성 👎**

- **Stateful** : 모든 사용자의 인증상태(Session)를 유지하고 있어야 함
- **Traffic 고려 O**: 사용자가 많아지면 Session 저장소가 Traffic을 감당해야 함 (조회, 등록)
- **공유 자원 O** : Server 증설시 Session 저장소를 공유해야 함

## 🎟 Token 인증
![](https://i.imgur.com/OJWsAfP.png)

**확장성 👍**

- **Stateless** : Session 저장소 처럼 사용자의 인증 상태 데이터를 별도 저장소로 유지할 필요가 없음
- **Traffic 고려 X**, **공유 자원 X** : 각 Server가 토큰 발급만 잘 해주면 됨
- 

# JWT
스프링 시큐리티에서 기본으로 생성되는 JSESSIONID토큰은 단점이 있기 때문에 상급 토큰이 필요하다.

### Jwt 토큰 (JSON Web Token)
- 내부적으로 데이터를 JSON형식으로 유지한다.
- 웹요청에 사용된다.
- 특히 UI클라이언트에서 백엔드 애플리케이션과 통신할때 사용되며 REST서비스의 도움으로 JSON형식으로 통신하기 위해 설계 되었다.
- 가장 많이 사용되고 선호되는 토큰 종류
- 다른 토큰처럼 인증 및 권한 부여 중에 사용가능

##### 장점
- Jwt 토큰 자체에서 유저와 관련된 필요한 정보를 모두 갖고 있어 무상태(Stateless) 가능. 이는 서버 쪽 세션 안에 유저에 대한 정보를 갖고 있어야 하는 번거로움을 줄여 준다. 
- 여러 서비스가 서로와 소통하려는 마이크로서비스 환경 속에서 큰 도움이 된다. 

### JWT 토큰의 구조
: 헤더와 페이로드는 필수

- 3파트로 구분되며 점(.)으로 구분됨
- 헤더(Header) - 토큰에 대한 정보인 메타데이터가 저장됨. 알고리즘이 무엇인지, 토큰의 종류가 무엇인지 정보. 메타데이터를 Base64로 인코딩 하는 방식 추천함.
- 페이로드(Payload) - 바디라고도 부름. 저장을 원하는 유저에 대한 모든 정보를 저장 가능. 유저 정보, 토큰 발행자, 토큰만료 시간 등 다양한 정보를 저장한다. Base64로 인코딩 하는 방식 추천함.
- 디지털 서명(Signature)(Optional) - 네트워크가 방화벽 내에 있으면 재 서명 하지 않아도 됨. 인터넷 환경에서는 헤더와 바디 값을 조작하지 않도록 할때 필요. 백엔드 서버는 토큰이 발급되면 디지털 서명을 한다.(SHA-256 알고리즘 등으로)

#### 동작과정
- 로그인 과정이 성공적으로 진행되면 백엔드 애플리케이션에서 JWT토큰을 생성한다.
- 클라이언트는 동일한 토큰을 들고 요청한다. 
- 백엔드 서버는 토큰이 조작 되었는지 검사한다. JWT토큰을 생성 할 때마다 디지털 서명(Signature)을 하여  나중에 누가 조작하려고 하면 쉽게 감지할 수 있다.
- 디지털 서명 시 SHA-256 같은 알고리즘을 사용하여 헤더 내용 정보를 전달하며 이와함께 백엔드 애플리케이션에만 알려져 있는 secret을 사용한다. 
	- HMACSHA256(헤더.페이로드, secret)
- secret 값은 백엔드 애플리케이션만 알 수 있다.
- JWT토큰의 서명 부분은 이 알고리즘으로 생성된 해시 문자열 이다.
- 누군가가 토큰의 헤더 내용 서명 값 등 조작하면 백엔드 애플리케이션은 이를 쉽게 감지하고 세션을 무효화 시킬 수 있다.
- 백엔드 서버는 해시를 계산하여 기존 토큰의 시그니처에 저장된 해시와 비교한다. (저장소에 저장하지 않고도 값을 검증할 수 있음)



https://medium.com/@hwanght1/what-is-jwt-89889759ae37